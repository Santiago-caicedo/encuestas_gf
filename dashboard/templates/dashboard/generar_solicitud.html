{% extends 'dashboard/base_dashboard.html' %}

{% block content %}
<div class="max-w-4xl mx-auto">
    
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-bold text-slate-800">Invitar Proveedor</h1>
        <a href="{% url 'dashboard_home' %}" class="text-slate-500 hover:text-slate-700 text-sm">
            <i class="fas fa-arrow-left"></i> Volver al Dashboard
        </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        
        <div class="space-y-6">
            <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                <h2 class="font-bold text-lg mb-4">Generar Nuevo Enlace</h2>
                <p class="text-sm text-gray-500 mb-4">
                    Estás creando una invitación para el formulario: <strong>{{ cuestionario.titulo }}</strong>
                </p>

                <form method="POST">
                    {% csrf_token %}
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Nombre del Tercero</label>
                        {{ form.nombre_tercero }}
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Correo Electrónico</label>
                        {{ form.email_tercero }}
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded font-bold hover:bg-blue-700 transition">
                        Generar Link Único
                    </button>
                </form>
            </div>

            {% if link_generado %}
            <div class="bg-green-50 border border-green-200 p-4 rounded-lg animate-pulse">
                <h3 class="text-green-800 font-bold text-sm mb-2"><i class="fas fa-check-circle"></i> Enlace Generado con Éxito</h3>
                <div class="flex gap-2">
                    <input type="text" value="{{ link_generado }}" id="urlInput" class="w-full text-xs p-2 border rounded text-gray-600 bg-white" readonly>
                    <button onclick="copiarLink()" class="bg-green-600 text-white px-3 py-1 rounded text-xs font-bold hover:bg-green-700">
                        Copiar
                    </button>
                </div>
            </div>
            <script>
                function copiarLink() {
                    var copyText = document.getElementById("urlInput");
                    copyText.select();
                    navigator.clipboard.writeText(copyText.value);
                    alert("Link copiado al portapapeles");
                }
            </script>
            {% endif %}
        </div>

        <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 h-fit">
            <h2 class="font-bold text-lg mb-4 text-slate-700">Últimas Invitaciones</h2>
            <div class="space-y-3">
                {% for sol in ultimas_solicitudes %}
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded border border-gray-100">
                    <div>
                        <p class="text-sm font-bold text-slate-800">{{ sol.nombre_tercero }}</p>
                        <p class="text-xs text-gray-500">{{ sol.email_tercero }}</p>
                    </div>
                    <div class="text-right">
                        {% if sol.completado %}
                            <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Completado</span>
                        {% else %}
                            <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">Pendiente</span>
                        {% endif %}
                        <p class="text-[10px] text-gray-400 mt-1">{{ sol.created_at|date:"d M H:i" }}</p>
                    </div>
                </div>
                {% empty %}
                <p class="text-sm text-gray-400 italic">No hay invitaciones recientes.</p>
                {% endfor %}
            </div>
        </div>

    </div>
</div>
{% endblock %}